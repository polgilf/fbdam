# Activate venv
.venv\Scripts\Activate.ps1

#  Check the register names ('rg' is not recognized)
Linux:
rg "@register_constraint" -n src/fbdam/engine/constraints.py
Windows:
Select-String -Path src/fbdam/engine/constraints.py -Pattern "@register_constraint" | Select-Object LineNumber, Line

# Run demo
python -m fbdam.engine.run run scenarios/demo.yaml --outputs outputs/demo

# Clear paths (from demo)
python utilities/clear_path.py outputs/demo

# Tests
pytest tests/test_model_backbone.py::test_purchase_budget_enforces_allocation_of_purchases 
pytest tests/test_model_backbone.py
pytest tests/test_smoke.py

# Analysis
python analysis/kpi_table.py --datasets ds-a --configs dials-efficiency dials-balanced dials-fairness dials-adequacy dials-fairness-adequacy --output "analysis/tables/kpis.csv"

# Plots
# Total allocation of each household (barplot)
python analysis/plot_allocation_from_solution_dir.py "runs/ds-a/dials-balanced" "analysis/plots/demo_allocated_food_ds-a_balanced.png"
python analysis/plot_allocation_from_solution_dir.py "runs/ds-a/dials-efficiency" "analysis/plots/demo_allocated_food_ds-a_efficiency.png"
python analysis/plot_from_solution_dir.py "runs/ds-a/dials-fairness" "analysis/plots/demo_allocated_food_ds-a_fairness.png"

# Allocation per person of each household (barplot)
python analysis/plot_allocation_per_member_from_solution_dir.py "runs/ds-a/dials-balanced" "analysis/plots/demo_allocated_per_member_food_ds-a_balanced.png" --ymax 12
python analysis/plot_allocation_per_member_from_solution_dir.py "runs/ds-a/dials-efficiency" "analysis/plots/demo_allocated_per_member_food_ds-a_efficiency.png" --ymax 12
python analysis/plot_allocation_per_member_from_solution_dir.py "runs/ds-a/dials-fairness" "analysis/plots/demo_allocated_per_member_food_ds-a_fairness.png" --ymax 12
python analysis/plot_allocation_per_member_from_solution_dir.py "runs/ds-a/dials-adequacy" "analysis/plots/demo_allocated_per_member_food_ds-a_adequacy.png" --ymax 12


python analysis/plot_allocation_kpis.py "analysis/tables/kpis.csv"
python analysis/plot_allocation_kpis.py

# Run
# In bash 
bash run_experiment.sh